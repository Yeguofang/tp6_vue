{"remainingRequest":"/Users/yeguofang/www/tp6_vue_10/node_modules/babel-loader/lib/index.js!/Users/yeguofang/www/tp6_vue_10/src/assets/js/cropper/sitelogo.js","dependencies":[{"path":"/Users/yeguofang/www/tp6_vue_10/src/assets/js/cropper/sitelogo.js","mtime":1521879550000},{"path":"/Users/yeguofang/www/tp6_vue_10/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/yeguofang/www/tp6_vue_10/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.find\";\nimport _typeof from \"/Users/yeguofang/www/tp6_vue_10/node_modules/@babel/runtime-corejs2/helpers/esm/typeof\";\n\n(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['jquery'], factory);\n  } else if ((typeof exports === \"undefined\" ? \"undefined\" : _typeof(exports)) === 'object') {\n    // Node / CommonJS\n    factory(require('jquery'));\n  } else {\n    factory(jQuery);\n  }\n})(function ($) {\n  'use strict';\n\n  var console = window.console || {\n    log: function log() {}\n  };\n\n  function CropAvatar($element) {\n    this.$container = $element;\n    this.$avatarView = this.$container.find('.img');\n    this.$avatar = this.$avatarView.find('img');\n    this.$avatarModal = $('#avatar-modal'); // this.$loading = $(\"#crop-avatar\").find('.img');\n\n    this.$avatarForm = this.$avatarModal.find('.avatar-form');\n    this.$avatarUpload = this.$avatarForm.find('.avatar-upload');\n    this.$avatarSrc = this.$avatarForm.find('.avatar-src');\n    this.$avatarData = this.$avatarForm.find('.avatar-data');\n    this.$avatarInput = this.$avatarForm.find('.avatar-input');\n    this.$avatarSave = this.$avatarForm.find('.avatar-save');\n    this.$avatarBtns = this.$avatarForm.find('.avatar-btns');\n    this.$avatarWrapper = this.$avatarModal.find('.avatar-wrapper');\n    this.$avatarPreview = this.$avatarModal.find('.avatar-preview');\n    this.init();\n  }\n\n  CropAvatar.prototype = {\n    constructor: CropAvatar,\n    support: {\n      fileList: !!$('<input type=\"file\">').prop('files'),\n      blobURLs: !!window.URL && URL.createObjectURL,\n      formData: !!window.FormData\n    },\n    init: function init() {\n      this.support.datauri = this.support.fileList && this.support.blobURLs;\n\n      if (!this.support.formData) {\n        this.initIframe();\n      }\n\n      this.initTooltip();\n      this.initModal();\n      this.addListener();\n    },\n    addListener: function addListener() {\n      this.$avatarView.on('click', $.proxy(this.click, this));\n      this.$avatarInput.on('change', $.proxy(this.change, this));\n      this.$avatarForm.on('submit', $.proxy(this.submit, this));\n      this.$avatarBtns.on('click', $.proxy(this.rotate, this));\n    },\n    initTooltip: function initTooltip() {\n      this.$avatarView.tooltip({\n        placement: 'bottom'\n      });\n    },\n    initModal: function initModal() {\n      this.$avatarModal.modal({\n        show: false\n      });\n    },\n    initPreview: function initPreview() {\n      var url = this.$avatar.attr('src');\n      this.$avatarPreview.empty().html('<img src=\"' + url + '\">');\n    },\n    initIframe: function initIframe() {\n      var target = 'upload-iframe-' + new Date().getTime(),\n          $iframe = $('<iframe>').attr({\n        name: target,\n        src: ''\n      }),\n          _this = this; // Ready ifrmae\n\n\n      $iframe.one('load', function () {\n        // respond response\n        $iframe.on('load', function () {\n          var data;\n\n          try {\n            data = $(this).contents().find('body').text();\n          } catch (e) {\n            console.log(e.message);\n          }\n\n          if (data) {\n            try {\n              data = $.parseJSON(data);\n            } catch (e) {\n              console.log(e.message);\n            }\n\n            _this.submitDone(data);\n          } else {\n            _this.submitFail('Image upload failed!');\n          }\n\n          _this.submitEnd();\n        });\n      });\n      this.$iframe = $iframe;\n      this.$avatarForm.attr('target', target).after($iframe.hide());\n    },\n    click: function click() {\n      this.$avatarModal.modal('show');\n      this.initPreview();\n    },\n    change: function change() {\n      var files, file;\n\n      if (this.support.datauri) {\n        files = this.$avatarInput.prop('files');\n\n        if (files.length > 0) {\n          file = files[0];\n\n          if (this.isImageFile(file)) {\n            if (this.url) {\n              URL.revokeObjectURL(this.url); // Revoke the old one\n            }\n\n            this.url = URL.createObjectURL(file);\n            this.startCropper();\n          }\n        }\n      } else {\n        file = this.$avatarInput.val();\n\n        if (this.isImageFile(file)) {\n          this.syncUpload();\n        }\n      }\n    },\n    submit: function submit() {\n      if (!this.$avatarSrc.val() && !this.$avatarInput.val()) {\n        return false;\n      }\n\n      if (this.support.formData) {\n        this.ajaxUpload();\n        return false;\n      }\n    },\n    rotate: function rotate(e) {\n      var data;\n\n      if (this.active) {\n        data = $(e.target).data();\n\n        if (data.method) {\n          this.$img.cropper(data.method, data.option);\n        }\n      }\n    },\n    isImageFile: function isImageFile(file) {\n      if (file.type) {\n        return /^image\\/\\w+$/.test(file.type);\n      } else {\n        return /\\.(jpg|jpeg|png|gif)$/.test(file);\n      }\n    },\n    startCropper: function startCropper() {\n      var _this = this;\n\n      if (this.active) {\n        this.$img.cropper('replace', this.url);\n      } else {\n        this.$img = $('<img src=\"' + this.url + '\">');\n        this.$avatarWrapper.empty().html(this.$img);\n        this.$img.cropper({\n          aspectRatio: 1,\n          preview: this.$avatarPreview.selector,\n          strict: false,\n          crop: function crop(data) {\n            var json = ['{\"x\":' + data.x, '\"y\":' + data.y, '\"height\":' + data.height, '\"width\":' + data.width, '\"rotate\":' + data.rotate + '}'].join();\n\n            _this.$avatarData.val(json);\n          }\n        });\n        this.active = true;\n      }\n    },\n    stopCropper: function stopCropper() {\n      if (this.active) {\n        this.$img.cropper('destroy');\n        this.$img.remove();\n        this.active = false;\n      }\n    },\n    ajaxUpload: function ajaxUpload() {\n      var url = this.$avatarForm.attr('action'),\n          data = new FormData(this.$avatarForm[0]),\n          _this = this;\n\n      $.ajax(url, {\n        headers: {\n          'X-XSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        },\n        type: 'post',\n        data: data,\n        dataType: 'json',\n        processData: false,\n        contentType: false,\n        beforeSend: function beforeSend() {\n          _this.submitStart();\n        },\n        success: function success(data) {\n          _this.submitDone(data);\n        },\n        error: function error(XMLHttpRequest, textStatus, errorThrown) {\n          _this.submitFail(textStatus || errorThrown);\n        },\n        complete: function complete() {\n          _this.submitEnd();\n        }\n      });\n    },\n    syncUpload: function syncUpload() {\n      this.$avatarSave.click();\n    },\n    submitStart: function submitStart() {// this.$loading.fadeIn();\n    },\n    submitDone: function submitDone(data) {\n      if ($.isPlainObject(data)) {\n        if (data.result) {\n          this.url = data.result;\n\n          if (this.support.datauri || this.uploaded) {\n            this.uploaded = false;\n            this.cropDone();\n          } else {\n            this.uploaded = true;\n            this.$avatarSrc.val(this.url);\n            this.startCropper();\n          }\n\n          this.$avatarInput.val('');\n        } else if (data.message) {\n          this.alert(data.message);\n        }\n      } else {\n        this.alert('Failed to response');\n      }\n    },\n    submitFail: function submitFail(msg) {\n      this.alert(msg);\n    },\n    submitEnd: function submitEnd() {// this.$loading.fadeOut();\n    },\n    cropDone: function cropDone() {\n      this.$avatarForm.get(0).reset();\n      this.$avatar.attr('src', this.url);\n      this.stopCropper();\n      this.$avatarModal.modal('hide');\n    },\n    alert: function alert(msg) {\n      var $alert = ['<div class=\"alert alert-danger avater-alert\">', '<button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button>', msg, '</div>'].join('');\n      this.$avatarUpload.after($alert);\n    }\n  };\n  $(function () {\n    return new CropAvatar($('#crop-avatar'));\n  });\n});",{"version":3,"sources":["/Users/yeguofang/www/tp6_vue_10/src/assets/js/cropper/sitelogo.js"],"names":["factory","define","amd","exports","require","jQuery","$","console","window","log","CropAvatar","$element","$container","$avatarView","find","$avatar","$avatarModal","$avatarForm","$avatarUpload","$avatarSrc","$avatarData","$avatarInput","$avatarSave","$avatarBtns","$avatarWrapper","$avatarPreview","init","prototype","constructor","support","fileList","prop","blobURLs","URL","createObjectURL","formData","FormData","datauri","initIframe","initTooltip","initModal","addListener","on","proxy","click","change","submit","rotate","tooltip","placement","modal","show","initPreview","url","attr","empty","html","target","Date","getTime","$iframe","name","src","_this","one","data","contents","text","e","message","parseJSON","submitDone","submitFail","submitEnd","after","hide","files","file","length","isImageFile","revokeObjectURL","startCropper","val","syncUpload","ajaxUpload","active","method","$img","cropper","option","type","test","aspectRatio","preview","selector","strict","crop","json","x","y","height","width","join","stopCropper","remove","ajax","headers","dataType","processData","contentType","beforeSend","submitStart","success","error","XMLHttpRequest","textStatus","errorThrown","complete","isPlainObject","result","uploaded","cropDone","alert","msg","get","reset","$alert"],"mappings":"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","sourcesContent":["(function (factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['jquery'], factory);\n  } else if (typeof exports === 'object') {\n    // Node / CommonJS\n    factory(require('jquery'));\n  } else {\n    factory(jQuery);\n  }\n})(function ($) {\n\n  'use strict';\n\n  var console = window.console || { log: function () {} };\n\n  function CropAvatar($element) {\n    this.$container = $element;\n\n    this.$avatarView = this.$container.find('.img');\n    this.$avatar = this.$avatarView.find('img');\n    this.$avatarModal = $('#avatar-modal');\n    // this.$loading = $(\"#crop-avatar\").find('.img');\n    this.$avatarForm = this.$avatarModal.find('.avatar-form');\n    this.$avatarUpload = this.$avatarForm.find('.avatar-upload');\n    this.$avatarSrc = this.$avatarForm.find('.avatar-src');\n    this.$avatarData = this.$avatarForm.find('.avatar-data');\n    this.$avatarInput = this.$avatarForm.find('.avatar-input');\n    this.$avatarSave = this.$avatarForm.find('.avatar-save');\n    this.$avatarBtns = this.$avatarForm.find('.avatar-btns');\n\n    this.$avatarWrapper = this.$avatarModal.find('.avatar-wrapper');\n    this.$avatarPreview = this.$avatarModal.find('.avatar-preview');\n\n    this.init();\n  }\n\n  CropAvatar.prototype = {\n    constructor: CropAvatar,\n    support: {\n      fileList: !!$('<input type=\"file\">').prop('files'),\n      blobURLs: !!window.URL && URL.createObjectURL,\n      formData: !!window.FormData\n    },\n\n    init: function () {\n      this.support.datauri = this.support.fileList && this.support.blobURLs;\n\n      if (!this.support.formData) {\n        this.initIframe();\n      }\n\n      this.initTooltip();\n      this.initModal();\n      this.addListener();\n    },\n\n    addListener: function () {\n      this.$avatarView.on('click', $.proxy(this.click, this));\n      this.$avatarInput.on('change', $.proxy(this.change, this));\n      this.$avatarForm.on('submit', $.proxy(this.submit, this));\n      this.$avatarBtns.on('click', $.proxy(this.rotate, this));\n    },\n\n    initTooltip: function () {\n      this.$avatarView.tooltip({\n        placement: 'bottom'\n      });\n    },\n\n    initModal: function () {\n      this.$avatarModal.modal({\n        show: false\n      });\n    },\n\n    initPreview: function () {\n      var url = this.$avatar.attr('src');\n\n      this.$avatarPreview.empty().html('<img src=\"' + url + '\">');\n    },\n\n    initIframe: function () {\n      var target = 'upload-iframe-' + (new Date()).getTime(),\n          $iframe = $('<iframe>').attr({\n            name: target,\n            src: ''\n          }),\n          _this = this;\n\n      // Ready ifrmae\n      $iframe.one('load', function () {\n\n        // respond response\n        $iframe.on('load', function () {\n          var data;\n\n          try {\n            data = $(this).contents().find('body').text();\n          } catch (e) {\n            console.log(e.message);\n          }\n\n          if (data) {\n            try {\n              data = $.parseJSON(data);\n            } catch (e) {\n              console.log(e.message);\n            }\n\n            _this.submitDone(data);\n          } else {\n            _this.submitFail('Image upload failed!');\n          }\n\n          _this.submitEnd();\n\n        });\n      });\n\n      this.$iframe = $iframe;\n      this.$avatarForm.attr('target', target).after($iframe.hide());\n    },\n\n    click: function () {\n      this.$avatarModal.modal('show');\n      this.initPreview();\n    },\n\n    change: function () {\n      var files,\n          file;\n\n      if (this.support.datauri) {\n        files = this.$avatarInput.prop('files');\n\n        if (files.length > 0) {\n          file = files[0];\n\n          if (this.isImageFile(file)) {\n            if (this.url) {\n              URL.revokeObjectURL(this.url); // Revoke the old one\n            }\n\n            this.url = URL.createObjectURL(file);\n            this.startCropper();\n          }\n        }\n      } else {\n        file = this.$avatarInput.val();\n\n        if (this.isImageFile(file)) {\n          this.syncUpload();\n        }\n      }\n    },\n\n    submit: function () {\n      if (!this.$avatarSrc.val() && !this.$avatarInput.val()) {\n        return false;\n      }\n\n      if (this.support.formData) {\n        this.ajaxUpload();\n        return false;\n      }\n    },\n\n    rotate: function (e) {\n      var data;\n\n      if (this.active) {\n        data = $(e.target).data();\n\n        if (data.method) {\n          this.$img.cropper(data.method, data.option);\n        }\n      }\n    },\n\n    isImageFile: function (file) {\n      if (file.type) {\n        return /^image\\/\\w+$/.test(file.type);\n      } else {\n        return /\\.(jpg|jpeg|png|gif)$/.test(file);\n      }\n    },\n\n    startCropper: function () {\n      var _this = this;\n\n      if (this.active) {\n        this.$img.cropper('replace', this.url);\n      } else {\n        this.$img = $('<img src=\"' + this.url + '\">');\n        this.$avatarWrapper.empty().html(this.$img);\n        this.$img.cropper({\n          aspectRatio: 1,\n          preview: this.$avatarPreview.selector,\n          strict: false,\n          crop: function (data) {\n            var json = [\n                  '{\"x\":' + data.x,\n                  '\"y\":' + data.y,\n                  '\"height\":' + data.height,\n                  '\"width\":' + data.width,\n                  '\"rotate\":' + data.rotate + '}'\n                ].join();\n\n            _this.$avatarData.val(json);\n          }\n        });\n\n        this.active = true;\n      }\n    },\n\n    stopCropper: function () {\n      if (this.active) {\n        this.$img.cropper('destroy');\n        this.$img.remove();\n        this.active = false;\n      }\n    },\n\n    ajaxUpload: function () {\n      var url = this.$avatarForm.attr('action'),\n          data = new FormData(this.$avatarForm[0]),\n          _this = this;\n\n      $.ajax(url, {\n        headers: {'X-XSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')}, \n        type: 'post',\n        data: data,\n        dataType: 'json',\n        processData: false,\n        contentType: false,\n\n        beforeSend: function () {\n          _this.submitStart();\n        },\n\n        success: function (data) {\n          _this.submitDone(data);\n        },\n\n        error: function (XMLHttpRequest, textStatus, errorThrown) {\n          _this.submitFail(textStatus || errorThrown);\n        },\n\n        complete: function () {\n          _this.submitEnd();\n        }\n      });\n    },\n\n    syncUpload: function () {\n      this.$avatarSave.click();\n    },\n\n    submitStart: function () {\n      // this.$loading.fadeIn();\n    },\n\n    submitDone: function (data) {\n      if ($.isPlainObject(data)) {\n        if (data.result) {\n          this.url = data.result;\n          if (this.support.datauri || this.uploaded) {\n            this.uploaded = false;\n            this.cropDone();\n          } else {\n            this.uploaded = true;\n            this.$avatarSrc.val(this.url);\n            this.startCropper();\n          }\n          this.$avatarInput.val('');\n        } else if (data.message) {\n          this.alert(data.message);\n        }\n      } else {\n        this.alert('Failed to response');\n      }\n    },\n\n    submitFail: function (msg) {\n      this.alert(msg);\n    },\n\n    submitEnd: function () {\n      // this.$loading.fadeOut();\n    },\n\n    cropDone: function () {\n      this.$avatarForm.get(0).reset();\n      this.$avatar.attr('src', this.url);\n      this.stopCropper();\n      this.$avatarModal.modal('hide');\n    },\n\n    alert: function (msg) {\n      var $alert = [\n            '<div class=\"alert alert-danger avater-alert\">',\n              '<button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button>',\n              msg,\n            '</div>'\n          ].join('');\n\n      this.$avatarUpload.after($alert);\n    }\n  };\n\n  $(function () {\n    return new CropAvatar($('#crop-avatar'));\n  });\n\n});\n"]}]}